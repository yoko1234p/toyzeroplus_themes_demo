{%- comment -%}
  Company Mode - Product Detail Page (Â∞çÈΩä React ProductPage.tsx)
  Âø´Ê®ÇÂç∞Âà∑Áî¢ÂìÅË©≥ÊÉÖÈ†Å
{%- endcomment -%}

{%- liquid
  assign primary_color = settings.color_primary | default: '#C83F49'
  assign gold_color = settings.color_secondary | default: '#B08D57'
  assign bg_color = settings.color_background | default: '#F9F9F9'
-%}

<div class="product-page min-h-screen py-8 px-4 md:px-8" style="background-color: {{ bg_color }};">

  {%- comment -%} Back Button - Â∞çÈΩä React {%- endcomment -%}
  <a href="{{ routes.root_url }}" class="mb-8 inline-flex items-center gap-2 text-sm font-lhkk transition-colors hover:opacity-70" style="color: rgba(51, 51, 51, 0.6);">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    Âõû‰∏ªÈ†Å
  </a>

  <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12">

    {%- comment -%} ===== LEFT: Product Images ===== {%- endcomment -%}
    <div class="space-y-4">
      {%- comment -%} Main Image - Â∞çÈΩä React {%- endcomment -%}
      <div class="aspect-square bg-white border p-4 flex items-center justify-center" style="border-color: #EAEAEA;">
        {%- if product.featured_image -%}
          <img
            id="ProductMainImage"
            src="{{ product.featured_image | image_url: width: 800 }}"
            alt="{{ product.featured_image.alt | default: product.title }}"
            width="800"
            height="800"
            class="max-w-full max-h-full object-contain"
          >
        {%- else -%}
          <span class="font-lhkk text-8xl" style="color: {{ gold_color }};">Á≥ï</span>
        {%- endif -%}
      </div>

      {%- comment -%} Thumbnail Gallery - Â∞çÈΩä React {%- endcomment -%}
      {%- if product.images.size > 1 -%}
        <div class="flex gap-2">
          {%- for image in product.images limit: 4 -%}
            <button
              class="w-20 h-20 border-2 p-1 transition-colors thumbnail-btn"
              style="border-color: {% if forloop.first %}{{ primary_color }}{% else %}#EAEAEA{% endif %};"
              onclick="
                document.getElementById('ProductMainImage').src='{{ image | image_url: width: 800 }}';
                document.querySelectorAll('.thumbnail-btn').forEach(btn => btn.style.borderColor = '#EAEAEA');
                this.style.borderColor = '{{ primary_color }}';
              "
            >
              <img
                src="{{ image | image_url: width: 200 }}"
                alt="{{ image.alt | default: product.title }}"
                width="200"
                height="200"
                class="w-full h-full object-contain"
              >
            </button>
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} ===== RIGHT: Product Info ===== {%- endcomment -%}
    <div class="space-y-6">

      {%- comment -%} Category + Title + English Name - Â∞çÈΩä React {%- endcomment -%}
      <div>
        {%- if product.type != blank -%}
          <p class="text-xs tracking-widest uppercase mb-2" style="color: rgba(51, 51, 51, 0.6);">
            {{ product.type }}
          </p>
        {%- endif -%}

        <h1 class="text-3xl md:text-4xl font-bold mb-2 font-lhkk" style="color: #333;">
          {{ product.title }}
        </h1>

        {%- if product.metafields.custom.english_name != blank -%}
          <p class="text-sm" style="color: rgba(51, 51, 51, 0.6);">
            {{ product.metafields.custom.english_name }}
          </p>
        {%- endif -%}
      </div>

      {%- comment -%} Price with Discount Badge - Â∞çÈΩä React {%- endcomment -%}
      <div class="flex items-baseline gap-4">
        <span class="text-3xl font-bold" style="color: {{ primary_color }};">
          {{ product.price | money }}
        </span>
        {%- if product.compare_at_price > product.price -%}
          <span class="text-lg line-through" style="color: rgba(51, 51, 51, 0.6);">
            {{ product.compare_at_price | money }}
          </span>
          {%- assign savings = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
          <span class="px-2 py-1 text-xs font-bold" style="background-color: rgba(200, 63, 73, 0.1); color: {{ primary_color }};">
            -{{ savings }}%
          </span>
        {%- endif -%}
      </div>

      {%- comment -%} Description with Highlight - Â∞çÈΩä React {%- endcomment -%}
      <div class="py-6 border-t border-b" style="border-color: #EAEAEA;">
        <p class="text-base leading-relaxed font-lhkk" style="color: #333;">
          {%- if product.metafields.custom.highlight_text != blank -%}
            {%- assign desc = product.description | strip_html -%}
            {%- assign highlight = product.metafields.custom.highlight_text -%}
            {%- if desc contains highlight -%}
              {%- assign parts = desc | split: highlight -%}
              {{ parts[0] }}<span class="product-highlight-text">{{ highlight }}</span>{{ parts | slice: 1, parts.size | join: highlight }}
            {%- else -%}
              {{ desc }}
            {%- endif -%}
          {%- else -%}
            {{ product.description | strip_html }}
          {%- endif -%}
        </p>
      </div>

      {%- comment -%} Features Section - Â∞çÈΩä React {%- endcomment -%}
      {%- if product.metafields.custom.features != blank -%}
        <div>
          <h3 class="text-sm font-bold mb-3 font-lhkk" style="color: #333;">
            Áî¢ÂìÅÁâπËâ≤
          </h3>
          <ul class="space-y-2">
            {%- assign features = product.metafields.custom.features | split: ',' -%}
            {%- for feature in features -%}
              <li class="flex items-center gap-2 text-sm" style="color: rgba(51, 51, 51, 0.6);">
                <span style="color: {{ primary_color }};">‚úì</span>
                {{ feature | strip }}
              </li>
            {%- endfor -%}
          </ul>
        </div>
      {%- endif -%}

      {%- comment -%} Pickup Methods - Â∞çÈΩä React {%- endcomment -%}
      {%- if product.metafields.custom.pickup_methods != blank -%}
        <div class="p-4 border bg-white" style="border-color: #EAEAEA;">
          <h3 class="text-sm font-bold mb-3 font-lhkk" style="color: #333;">
            ÂèñË≤®ÊñπÂºè
          </h3>
          {%- assign methods = product.metafields.custom.pickup_methods | split: '|' -%}
          {%- for method in methods -%}
            {%- assign parts = method | split: ':' -%}
            <div class="flex items-start gap-3 {% unless forloop.last %}mb-2{% endunless %}">
              <span class="text-2xl">{{ parts[0] | strip }}</span>
              <div>
                <p class="font-medium" style="color: #333;">{{ parts[1] | strip }}</p>
                {%- if parts[2] -%}
                  <p class="text-sm" style="color: rgba(51, 51, 51, 0.6);">{{ parts[2] | strip }}</p>
                {%- endif -%}
              </div>
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}

      {%- comment -%} Redemption Info - Â∞çÈΩä React {%- endcomment -%}
      <div class="text-sm space-y-2" style="color: rgba(51, 51, 51, 0.6);">
        {%- if product.metafields.custom.redemption_period != blank -%}
          <p><strong style="color: #333;">ÊèõÈ†òÊúüÔºö</strong>{{ product.metafields.custom.redemption_period }}</p>
        {%- endif -%}

        {%- if product.metafields.custom.redemption_locations != blank -%}
          <p><strong style="color: #333;">ÊèõÈ†òÂú∞ÈªûÔºö</strong></p>
          <ul class="list-disc list-inside pl-2">
            {%- assign locations = product.metafields.custom.redemption_locations | split: ',' -%}
            {%- for loc in locations -%}
              <li>{{ loc | strip }}</li>
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- if product.variants.first.weight > 0 -%}
          <p><strong style="color: #333;">ÈáçÈáèÔºö</strong>{{ product.variants.first.weight | weight_with_unit }}</p>
        {%- endif -%}

        {%- if product.metafields.custom.dimensions != blank -%}
          <p><strong style="color: #333;">Â∞∫ÂØ∏Ôºö</strong>{{ product.metafields.custom.dimensions }}</p>
        {%- endif -%}

        {%- if product.metafields.custom.made_in != blank -%}
          <p><strong style="color: #333;">Áî¢Âú∞Ôºö</strong>{{ product.metafields.custom.made_in }}</p>
        {%- endif -%}
      </div>

      {%- comment -%} Quantity & Add to Cart - Â∞çÈΩä React {%- endcomment -%}
      {% form 'product', product %}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

        {%- comment -%} Variant Selector {%- endcomment -%}
        {%- if product.has_only_default_variant == false -%}
          {%- for option in product.options_with_values -%}
            <div class="mb-4">
              <label class="block font-lhkk text-sm mb-2" style="color: #333;">
                {{ option.name }}
              </label>
              <select
                name="options[{{ option.name }}]"
                class="w-full px-4 py-3 border font-lhkk focus:outline-none"
                style="border-color: #EAEAEA;"
              >
                {%- for value in option.values -%}
                  <option value="{{ value }}" {% if option.selected_value == value %}selected{% endif %}>
                    {{ value }}
                  </option>
                {%- endfor -%}
              </select>
            </div>
          {%- endfor -%}
        {%- endif -%}

        <div class="flex flex-col sm:flex-row gap-4">
          {%- comment -%} Quantity Selector - Â∞çÈΩä React {%- endcomment -%}
          <div class="flex items-center border" style="border-color: #EAEAEA;">
            <button
              type="button"
              class="px-4 py-3 transition-colors hover:opacity-70"
              style="color: rgba(51, 51, 51, 0.6);"
              onclick="this.nextElementSibling.stepDown(); this.nextElementSibling.dispatchEvent(new Event('change'))"
            >
              -
            </button>
            <input
              type="number"
              name="quantity"
              value="1"
              min="1"
              class="w-12 py-3 text-center font-medium focus:outline-none"
              style="color: #333;"
            >
            <button
              type="button"
              class="px-4 py-3 transition-colors hover:opacity-70"
              style="color: rgba(51, 51, 51, 0.6);"
              onclick="this.previousElementSibling.stepUp(); this.previousElementSibling.dispatchEvent(new Event('change'))"
            >
              +
            </button>
          </div>

          {%- comment -%} Add to Cart Button - Â∞çÈΩä React {%- endcomment -%}
          <button
            type="submit"
            name="add"
            class="flex-1 py-3 px-8 font-bold tracking-widest text-sm transition-colors font-lhkk text-white"
            style="background-color: {{ primary_color }};"
            {% unless product.available %}disabled{% endunless %}
          >
            {%- if product.available -%}
              Âä†ÂÖ•Ë≥ºÁâ©Ëªä
            {%- else -%}
              ÂîÆÁΩÑ
            {%- endif -%}
          </button>
        </div>
      {% endform %}

      {%- comment -%} Made in HK Badge - Â∞çÈΩä React {%- endcomment -%}
      <div class="flex items-center gap-2 pt-4">
        <span class="text-2xl">üá≠üá∞</span>
        <span class="text-sm" style="color: rgba(51, 51, 51, 0.6);">100% È¶ôÊ∏ØË£ΩÈÄ†</span>
      </div>
    </div>
  </div>

  {%- comment -%} Ingredients Section - Â∞çÈΩä React {%- endcomment -%}
  {%- if product.metafields.custom.ingredients != blank -%}
    <div class="max-w-6xl mx-auto mt-16 pt-8 border-t" style="border-color: #EAEAEA;">
      <h2 class="text-xl font-bold mb-4 font-lhkk" style="color: #333;">
        ‰∏ªË¶ÅÊàêÂàÜ
      </h2>
      <div class="flex flex-wrap gap-2">
        {%- assign ingredients = product.metafields.custom.ingredients | split: ',' -%}
        {%- for ing in ingredients -%}
          <span class="px-3 py-1 text-sm border" style="border-color: #EAEAEA; color: rgba(51, 51, 51, 0.6);">
            {{ ing | strip }}
          </span>
        {%- endfor -%}
      </div>
    </div>
  {%- endif -%}

  {%- comment -%} Related Products - Â∞çÈΩä React {%- endcomment -%}
  {%- if section.settings.show_related -%}
    <div class="max-w-6xl mx-auto mt-16 pt-8 border-t" style="border-color: #EAEAEA;">
      <h2 class="text-xl font-bold mb-6 font-lhkk" style="color: #333;">
        ‰Ω†ÂèØËÉΩÈÇÑÊÑüËààË∂£ÁöÑ
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {%- for rec_product in product.collections.first.products limit: 2 -%}
          {%- if rec_product.id != product.id -%}
            <a href="{{ rec_product.url }}" class="group flex gap-4 p-4 border bg-white hover:shadow-lg transition-all duration-300" style="border-color: #EAEAEA;">
              {%- comment -%} Product Image {%- endcomment -%}
              <div class="w-24 h-24 flex-shrink-0 border p-2 flex items-center justify-center" style="border-color: #EAEAEA;">
                {%- if rec_product.featured_image -%}
                  <img
                    src="{{ rec_product.featured_image | image_url: width: 200 }}"
                    alt="{{ rec_product.title }}"
                    width="200"
                    height="200"
                    class="max-w-full max-h-full object-contain transition-transform duration-300 group-hover:scale-105"
                  >
                {%- endif -%}
              </div>

              {%- comment -%} Product Info {%- endcomment -%}
              <div class="flex-1 flex flex-col justify-center">
                <p class="text-xs tracking-widest uppercase mb-1" style="color: rgba(51, 51, 51, 0.6);">
                  {{ rec_product.type }}
                </p>
                <h3 class="text-lg font-bold mb-1 font-lhkk transition-colors" style="color: #333;">
                  {{ rec_product.title }}
                </h3>
                <div class="flex items-center gap-2">
                  <span class="font-bold" style="color: {{ primary_color }};">{{ rec_product.price | money }}</span>
                  {%- if rec_product.compare_at_price > rec_product.price -%}
                    <span class="text-sm line-through" style="color: rgba(51, 51, 51, 0.6);">{{ rec_product.compare_at_price | money }}</span>
                  {%- endif -%}
                </div>
              </div>

              {%- comment -%} Arrow {%- endcomment -%}
              <div class="flex items-center transition-colors" style="color: rgba(51, 51, 51, 0.6);">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </a>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  {%- endif -%}
</div>

{%- comment -%} Highlight Text CSS - Â∞çÈΩä React {%- endcomment -%}
<style>
.product-highlight-text {
  background: linear-gradient(120deg, rgba(176, 141, 87, 0.35) 0%, rgba(212, 175, 55, 0.35) 100%);
  background-repeat: no-repeat;
  background-size: 100% 40%;
  background-position: 0 88%;
  padding: 2px 4px;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}
</style>

{% schema %}
{
  "name": "Áî¢ÂìÅÈ†Å",
  "tag": "section",
  "class": "main-product-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_related",
      "label": "È°ØÁ§∫Áõ∏ÈóúÁî¢ÂìÅ",
      "default": true
    }
  ]
}
{% endschema %}
